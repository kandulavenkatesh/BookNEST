doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Dashboard - BookNEST

    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin="anonymous")
    link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap")
    link(
      rel="stylesheet",
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css",
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN",
      crossorigin="anonymous"
    )

    style.
      :root {
        --ink: #0f172a;
        --mist: #f1f5f9;
        --teal: #0ea5e9;
        --amber: #f59e0b;
        --emerald: #10b981;
        --slate: #334155;
      }
      body {
        font-family: 'Space Grotesk', 'Helvetica Neue', Arial, sans-serif;
        background: radial-gradient(circle at 20% 20%, rgba(14,165,233,0.16), transparent 35%),
                    radial-gradient(circle at 80% 0%, rgba(16,185,129,0.16), transparent 30%),
                    #f8fafc;
        color: var(--slate);
      }
      .nav-card {
        border-radius: 18px;
        border: 1px solid #e2e8f0;
        background: #fff;
        box-shadow: 0 10px 40px rgba(15,23,42,0.05);
      }
      .pill {
        background: rgba(14,165,233,0.12);
        color: var(--teal);
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 600;
      }
      .pill-ink {
        background: rgba(15,23,42,0.06);
        color: var(--ink);
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 600;
      }
      .metric {
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        background: linear-gradient(145deg, #fff, #f8fafc);
        box-shadow: 0 12px 30px rgba(15,23,42,0.05);
      }
      .metric .value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--ink);
      }
      .chart-bar {
        height: 10px;
        border-radius: 999px;
        background: #e2e8f0;
        overflow: hidden;
      }
      .chart-bar span {
        display: block;
        height: 100%;
        border-radius: 999px;
        background: linear-gradient(120deg, var(--teal), var(--emerald));
      }
      .glass {
        background: rgba(255,255,255,0.72);
        border: 1px solid rgba(226,232,240,0.8);
        border-radius: 16px;
        box-shadow: 0 12px 28px rgba(15,23,42,0.08);
      }
      tr.clickable-row {
        cursor: pointer;
      }
      tr.clickable-row:hover {
        background: #f8fafc;
      }

  body
    .container-fluid.py-4.py-lg-5

      // ===== HEADER WITH CREATE BUTTON =====
      .nav-card.p-4.mb-4.d-flex.flex-wrap.align-items-center.justify-content-between.gap-3
        .d-flex.align-items-center.gap-3
          .pill Dashboard
          h1.h4.mb-0.fw-bold BookNEST Command Center

        .d-flex.align-items-center.gap-3
          if uid === 1
            a.btn.btn-primary.rounded-pill(href="/admin/books/create") + Create Book

          a.btn.btn-dark.rounded-pill(href="/") Home
          a.btn.btn-outline-primary.rounded-pill(href="/logout") Sign out

      // ===== METRICS =====
      .row.g-4
        .col-md-6.col-xl-3
          .metric.p-4.text-center
            h6.text-muted Total Books
            .value #{stats && stats.books || 0}
        .col-md-6.col-xl-3
          .metric.p-4.text-center
            h6.text-muted Authors
            .value #{stats && stats.authors || 0}
        .col-md-6.col-xl-3
          .metric.p-4.text-center
            h6.text-muted Publishers
            .value #{stats && stats.publishers || 0}
        .col-md-6.col-xl-3
          .metric.p-4.text-center
            h6.text-muted Categories
            .value #{stats && stats.categories || 0}

      // ===== BOOK LIST =====
      .row.g-4.mt-2
        .col-lg-8
          .glass.p-4
            h6.text-uppercase.text-muted.mb-3 Recent Books

            form.d-flex.gap-2.mb-3(method="get", action="/dashboard")
              input.form-control(
                type="text",
                name="search",
                placeholder="Search title, author, ISBN",
                value=filters && filters.search || ""
              )
              select.form-select(name="category")
                option(value="") All categories
                if allCategories
                  each cat in allCategories
                    option(value=cat.id selected=filters && filters.category == cat.id)= cat.name
              button.btn.btn-primary(type="submit") Filter

            table.table.align-middle
              thead.text-muted
                tr
                  th Cover
                  th Title
                  th Author
                  th Category
                  th Added
                  th.text-end Status

              tbody
                if books && books.length
                  each book in books
                    tr.clickable-row(data-href=`/books/${book.id}`)
                      td
                        img.rounded(
                          src=book.cover_image_url || 'https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?auto=format&fit=crop&w=200&q=80'
                          style="width:56px;height:84px;object-fit:cover;"
                        )
                      td
                        a.fw-bold.text-decoration-none(href=`/books/${book.id}`)= book.title
                        if book.isbn_13
                          br
                          small.text-muted ISBN #{book.isbn_13}
                      td #{book.author}
                      td #{book.categories || 'Uncategorized'}
                      td.text-muted #{book.added_on || '—'}
                      td.text-end
                        span.pill-ink In catalog
                else
                  tr
                    td(colspan="6").text-center.text-muted No books found.

        // ===== CATEGORY STATS =====
        .col-lg-4
          .glass.p-4
            h6.text-uppercase.text-muted.mb-3 Categories
            ul.list-unstyled
              if categoryStats
                each cat in categoryStats
                  li.mb-2
                    strong #{cat.name}
                    span.float-end.text-muted #{cat.total}

      .nav-card.mt-4.p-3.text-center.text-muted
        small Crafted for curious readers — BookNEST Dashboard

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js")
    script.
      document.querySelectorAll('tr.clickable-row').forEach(row => {
        row.addEventListener('click', () => {
          const href = row.getAttribute('data-href');
          if (href) window.location.href = href;
        });
      });
